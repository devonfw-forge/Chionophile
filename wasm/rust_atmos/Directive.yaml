# the Directive is a complete description of your application, including all of its business logic.
# appVersion should be updated for each new deployment of your app.
# atmoVersion declares which version of Atmo is used for the `subo dev` command.

identifier: com.suborbital.rust_wasm
appVersion: v0.1.0
atmoVersion: v0.4.7

connections:
  database:
    type: postgresql
    connectionString: postgresql://jtq_user:admin@jtq_postgres_intern:5432/jtq_db

queries:
  - name: "SelectVisitor"
    query: |-
      SELECT * FROM visitor
      WHERE id = $1
  #################################33
  # QUEUE:
  - name: "SelectQueue"
    query: |-
      SELECT * FROM dailyqueue
      WHERE id = $1

  - name: "DeleteQueue"
    query: |-
      DELETE FROM dailyqueue WHERE id = $1
      
  - name: "DeleteACQueue"
    query: |-
      DELETE FROM accesscode WHERE idqueue = $1

  - name: "CreateQueue"
    query: |-
      INSERT INTO queue(modificationcounter, name, logo, currentnumber, 
        attentiontime, minattetiontime, active)
      VALUES ($1, $2, $3, $4, $5, $6, $7)
      RETURNING id
  - name: "SelectLastIdQueue"
    query: |-
      SELECT currval('queue_id_seq');
  - name: "SearchQueue"
    query: |- 
        SELECT * FROM queue

handlers:
  - type: request
    resource: /jumpthequeue/services/rest/visitormanagement/v1/visitor/:id/
    method: GET
    steps:
      - fn: GetVisitor

  #################################33
  # QUEUE:
  - type: request
    resource: /jumpthequeue/services/rest/queuemanagement/v1/queue/:id/
    method: GET
    steps:
      - fn: GetQueue

  - type: request
    resource: /jumpthequeue/services/rest/queuemanagement/v1/queue/
    method: POST
    steps:
      - fn: CreateQueue

  - type: request
    resource: /jumpthequeue/services/rest/queuemanagement/v1/queue/:id/
    method: DELETE
    steps:
      - fn: DeleteQueue
